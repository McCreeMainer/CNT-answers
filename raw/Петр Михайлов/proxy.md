## Управление доставкой. Серверы-посредники.

**Управление доставкой - 3 способа:**
1. Маршрутизация
1. Шлюзы уровня приложений (ALG - application level gateway)
   1. Серверы посредники
   1. Трансляторы протоколов
      1. Стандартные трансляторы (SOCKS)
      1. Специализированные трансляторы
1. Трансляция адресов (NAT)

**Серверы-посредники:**
Основная идея – использовать посредников (proxy) для получения информации из Internet.

Решаемые задачи (или зачем посредники нужны):
1. Кэширование информации (трафик дорогой, сокращаем кол-во запросов)
1. Сокрытие внутренней части сети (скрываем от сервера карту нашей сети)
1. Сокращение времени доступа в сеть (медленная внешняя связь, экономим деньги и время, т.е. вместо запросов ищем информацию в локальном кэше)

Используют протоколы HTTP и FTP (т.к. обычно информация файлового типа), для других протоколов кэширование не делается, т.к обычно они обычно связаны с аутентификацией)
Для доступа к серверу-посреднику обычно используется HTTP. Чтобы запрос к серверу отправился к посреднику, на прикладном уровне в пакет пишем адрес сервера, а в канальный адрес посредника.

**Proxy-серверы для протокола FTP**

- HTTP-proxy для FTP
  - Используется протокол HTTP для доступа к proxy-серверу (т.к. проще указать адрес посредника)
  - Адрес FTP-сервера указывается в строке URL: ftp://ftp.example.com
  - Требует специального клиента(который работает и с http и ftp)

http://kspt.icc.spbstu.ru/media/files/2021/course/networks/Networks2021-06-Configuring.pdf - 10 слайд.

- FTP-proxy – серверы
  - Используется протокол FTP для доступа к proxy-серверу
  - Адрес FTP-сервера указывается в строке аутентификационных команд (USER или PASS) - т.е. вместо логина John будет John@ftp адрес
  - Не требует модификации клиента



**Серверы посредники**

- Обычно используют протокол доступа HTTP
- Используемые порты TCP:
  - 3128
  - 8080
  - 80 (если порт занимают и сервер, и прокси, тогда используется специальное программное обеспечение, которое анализирует url в запросе: если после днс-запроса ip адрес не совпадает, запрос переадресовывается на прокси, else на сервер.
  - 8000
- Программные пакеты
  - squid
  - Microsoft Forefront Threat Management Gateway
    - Ранее – MS ISA Server,MS Proxy Server
  - ...

**Иерархии**
Например у организации есть общий прокси и у каждого департамента организации есть прокси

- Два типа отношений (внешние запросы делают только родительские прокси, родственные только у друг друга в кэше):
  - Родительские/дочерние (parent)
  - Родственные (sibling)

Используется для

- Сокращение трафика
- Сокращение времени

Существует ограничение на уровень иерархии (т.к. при большой глубине иерархии скорей всего запрос будет быстрее отправить напрямую на веб-сервер). Ограничение обычно на 2 уровня.

На лекции был вопрос, кто должен платить за трафик в иерархической сети и должны ли платить те, кто воспользовался кэшем. Ответа точного нет, обычно иерархические схемы умирают, когда встает такой вопрос.

http://kspt.icc.spbstu.ru/media/files/2021/course/networks/Networks2021-06-Configuring.pdf - 13 слайд.


**Синхронизация кэшей** - обмен информации об имеющихся ресурсах и формирование соответствующих запросов.

- Синхронизация кэшей
  - Протокол ICP (Internet Cache Protocol) (легковесный)
    - RFC 2186 и RFC2187 (ICPv2)
    - Использует UDP, порт 3130

Если используете прокси, надо явно это указать в настройках браузера(если для доступа используются браузер). В настройках надо указать параметры веб-прокси, ip адрес, порт, аутентификационные данные. То есть технология не работает без явной настройки пользователя.